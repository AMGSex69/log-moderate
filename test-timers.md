# üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã—Ö —Ç–∞–π–º–µ—Ä–æ–≤

## üöÄ –®–∞–≥–∏ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### 1. **–ü—Ä–∏–º–µ–Ω–∏—Ç–µ SQL –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤ Supabase**

–ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **Supabase ‚Üí SQL Editor** –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞ `fix-timer-issues.sql`:

```sql
-- 1. –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å–µ—Å—Å–∏–π
UPDATE active_sessions 
SET is_active = false 
WHERE is_active = true 
AND last_heartbeat < NOW() - INTERVAL '2 hours';

-- 2. –£–¥–∞–ª–µ–Ω–∏–µ —Å–æ–≤—Å–µ–º —Å—Ç–∞—Ä—ã—Ö
DELETE FROM active_sessions 
WHERE last_heartbeat < NOW() - INTERVAL '24 hours';

-- 3. –°–æ–∑–¥–∞–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–æ–≤ –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
CREATE INDEX IF NOT EXISTS idx_active_sessions_heartbeat 
ON active_sessions(last_heartbeat) WHERE is_active = true;

-- 4. –û—á–∏—Å—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö
SELECT cleanup_old_timer_data();
```

### 2. **–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ**

```bash
# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –µ—Å–ª–∏ –∑–∞–ø—É—â–µ–Ω–æ (Ctrl+C)
# –ó–∞—Ç–µ–º –∑–∞–ø—É—Å—Ç–∏—Ç–µ –∑–∞–Ω–æ–≤–æ:
npm run dev
```

### 3. **–û—Ç–∫—Ä–æ–π—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞**

–ù–∞–∂–º–∏—Ç–µ **F12** ‚Üí –≤–∫–ª–∞–¥–∫–∞ **Console**

–í—ã –¥–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å –ª–æ–≥–∏:
```
üîÑ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è —Å–µ—Å—Å–∏–π...
üîÑ –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–µ —Å–µ—Å—Å–∏–∏...
‚ÑπÔ∏è –ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å–µ—Å—Å–∏–π –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è (–µ—Å–ª–∏ –∏—Ö –Ω–µ—Ç)
```

### 4. **–¢–µ—Å—Ç –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è —Å–µ—Å—Å–∏–π**

1. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ –∑–∞–¥–∞—á** (2-3 —à—Ç—É–∫–∏)
2. **–û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É** (F5)
3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å** - –¥–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å:
   ```
   ‚úÖ –ù–∞–π–¥–µ–Ω–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å–µ—Å—Å–∏–π: 3
   üìã –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–¥–∞—á—É: {...}
   ‚úÖ –ê–∫—Ç–∏–≤–Ω—ã–µ —Å–µ—Å—Å–∏–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã: 3
   ```
4. **–£–±–µ–¥–∏—Ç–µ—Å—å** —á—Ç–æ —Ç–∞–π–º–µ—Ä—ã –ø—Ä–æ–¥–æ–ª–∂–∞—é—Ç —Ä–∞–±–æ—Ç–∞—Ç—å

### 5. **–¢–µ—Å—Ç –∂–∏–≤—ã—Ö —Ç–∞–π–º–µ—Ä–æ–≤**

1. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ –∑–∞–¥–∞—á—É**
2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ —Ç–∞–π–º–µ—Ä –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É**
3. **–í –∫–æ–Ω—Å–æ–ª–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –ª–æ–≥–∏ –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É:**
   ```
   ‚ñ∂Ô∏è –ó–∞–ø—É—Å–∫–∞–µ–º –≥–ª–∞–≤–Ω—ã–π —Ç–∞–π–º–µ—Ä
   üìä –°–æ—Å—Ç–æ—è–Ω–∏–µ —Ç–∞–π–º–µ—Ä–æ–≤: {activeTasks: 1, timers: 1, mainTimerRunning: true}
   ```

### 6. **–¢–µ—Å—Ç –ª–∏–º–∏—Ç–æ–≤**

1. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ 3 –∑–∞–¥–∞—á–∏** - –¥–æ–ª–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å
2. **–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∑–∞–ø—É—Å—Ç–∏—Ç—å 4-—é** - –¥–æ–ª–∂–Ω–∞ –ø–æ–∫–∞–∑–∞—Ç—å—Å—è –æ—à–∏–±–∫–∞ "–ú–∞–∫—Å–∏–º—É–º 3 –∑–∞–¥–∞—á–∏ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ"
3. **–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∑–∞–ø—É—Å—Ç–∏—Ç—å —É–∂–µ –∞–∫—Ç–∏–≤–Ω—É—é –∑–∞–¥–∞—á—É** - –¥–æ–ª–∂–Ω–∞ –ø–æ–∫–∞–∑–∞—Ç—å—Å—è –æ—à–∏–±–∫–∞ "–ó–∞–¥–∞—á–∞ —É–∂–µ –∞–∫—Ç–∏–≤–Ω–∞"

## üîç –ß—Ç–æ –¥–æ–ª–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å –ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

‚úÖ **–¢–∞–π–º–µ—Ä—ã –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏**
‚úÖ **–ü—Ä–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∞–∫—Ç–∏–≤–Ω—ã–µ –∑–∞–¥–∞—á–∏ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è**
‚úÖ **–í—Ä–µ–º—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–æ –º–µ–∂–¥—É –≤—Å–µ–º–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏**
‚úÖ **Heartbeat –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥**
‚úÖ **–õ–∏–º–∏—Ç 3 –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–¥–∞—á —Ä–∞–±–æ—Ç–∞–µ—Ç**
‚úÖ **–ù–µ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–¥–∞—á**
‚úÖ **–ì–ª–∞–≤–Ω—ã–π —Ç–∞–π–º–µ—Ä –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è/–æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ**

## üêõ –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –ü—Ä–æ–±–ª–µ–º–∞: –¢–∞–π–º–µ—Ä—ã –Ω–µ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è
**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –Ω–∞ –æ—à–∏–±–∫–∏ JavaScript, —É–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –≥–ª–∞–≤–Ω—ã–π —Ç–∞–π–º–µ—Ä –∑–∞–ø—É—â–µ–Ω

### –ü—Ä–æ–±–ª–µ–º–∞: –°–µ—Å—Å–∏–∏ –Ω–µ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è
**–†–µ—à–µ–Ω–∏–µ:** 
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –≤ –ë–î –µ—Å—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–µ —Å–µ—Å—Å–∏–∏ —Å `is_active = true`
2. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ `last_heartbeat` –Ω–µ —Å—Ç–∞—Ä—à–µ 2 —á–∞—Å–æ–≤
3. –í—ã–ø–æ–ª–Ω–∏—Ç–µ SQL –æ—á–∏—Å—Ç–∫—É

### –ü—Ä–æ–±–ª–µ–º–∞: –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á
**–†–µ—à–µ–Ω–∏–µ:** 
1. –û—á–∏—Å—Ç–∏—Ç–µ –∞–∫—Ç–∏–≤–Ω—ã–µ —Å–µ—Å—Å–∏–∏ –≤ –ë–î
2. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ —Ñ—É–Ω–∫—Ü–∏—è `startTask` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `false` –¥–ª—è –¥—É–±–ª–∏–∫–∞—Ç–æ–≤

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤ Supabase

–í—ã–ø–æ–ª–Ω–∏—Ç–µ –≤ SQL Editor –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏:

```sql
-- –ê–∫—Ç–∏–≤–Ω—ã–µ —Å–µ—Å—Å–∏–∏
SELECT * FROM active_sessions_with_timing;

-- –ü—Ä–æ–±–ª–µ–º—ã —Å –¥–∞–Ω–Ω—ã–º–∏
SELECT * FROM validate_time_consistency();

-- –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –¥–∞–Ω–Ω—ã—Ö
SELECT cleanup_old_timer_data();
```

## üéâ –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç

–ü–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –≤—Å–µ—Ö –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:
- ‚è±Ô∏è –¢–∞–π–º–µ—Ä—ã —Ä–∞–±–æ—Ç–∞—é—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ –∏ –ø–ª–∞–≤–Ω–æ
- üîÑ –ê–∫—Ç–∏–≤–Ω—ã–µ –∑–∞–¥–∞—á–∏ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–µ
- üéØ –í—Ä–µ–º—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–æ –≤–µ–∑–¥–µ
- üö´ –ù–µ—Ç "–∑–∞–≤–∏—Å—à–∏—Ö" —Å–µ—Å—Å–∏–π –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
- üì± –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –±—ã—Å—Ç—Ä–æ –∏ –æ—Ç–∑—ã–≤—á–∏–≤–æ 