# üë§ –ö–∞—Ä—Ç–æ—á–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π - –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ

## üéØ –û–±–∑–æ—Ä —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏

–°–∏—Å—Ç–µ–º–∞ **–∫–∞—Ä—Ç–æ—á–µ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π** –ø–æ–∑–≤–æ–ª—è–µ—Ç –≤—Å–µ–º —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –±–∞–∑–æ–≤—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∫–æ–ª–ª–µ–≥–∞—Ö –∏ –∏—Ö —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É. –≠—Ç–æ –ø–æ–≤—ã—à–∞–µ—Ç –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å –∏ —Å–ø–æ—Å–æ–±—Å—Ç–≤—É–µ—Ç –ª—É—á—à–µ–π –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏ –≤ –∫–æ–º–∞–Ω–¥–µ.

## ‚ú® –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### üìã –ë–∞–∑–æ–≤–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è (–¥–æ—Å—Ç—É–ø–Ω–∞ –≤—Å–µ–º)
- **–§–ò–û** - –ø–æ–ª–Ω–æ–µ –∏–º—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞
- **–î–æ–ª–∂–Ω–æ—Å—Ç—å** - —Ç–µ–∫—É—â–∞—è –ø–æ–∑–∏—Ü–∏—è
- **–û—Ñ–∏—Å** - –º–µ—Å—Ç–æ —Ä–∞–±–æ—Ç—ã
- **–ì—Ä–∞—Ñ–∏–∫ —Ä–∞–±–æ—Ç—ã** - —Ä–∞–±–æ—á–µ–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ
- **–°—Ç–∞—Ç—É—Å –æ–Ω–ª–∞–π–Ω** - –≤ —Å–µ—Ç–∏ –∏–ª–∏ –≤—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
- **–î–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏** - –∫–æ–≥–¥–∞ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏–ª—Å—è –∫ —Å–∏—Å—Ç–µ–º–µ

### üîí –ö–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è (–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–π –¥–æ—Å—Ç—É–ø)
- **Email** - –¥–æ—Å—Ç—É–ø–µ–Ω —Ç–æ–ª—å–∫–æ:
  - –í–ª–∞–¥–µ–ª—å—Ü—É –ø—Ä–æ—Ñ–∏–ª—è
  - –°—É–ø–µ—Ä-–∞–¥–º–∏–Ω—É (egordolgih@mail.ru)

### üìä –î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- **–û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–¥–∞—á**
- **–ï–¥–∏–Ω–∏—Ü –≤—ã–ø–æ–ª–Ω–µ–Ω–æ**
- **–¢–µ–∫—É—â–∏–π —Å—Ç—Ä–∏–º** (–¥–Ω–µ–π –ø–æ–¥—Ä—è–¥)
- **–£—Ä–æ–≤–µ–Ω—å –∏–≥—Ä–æ–∫–∞**
- **–õ—É—á—à–∏–µ –∑–∞–¥–∞—á–∏** (—Ç–æ–ø-3)

## üöÄ –ì–¥–µ –º–æ–∂–Ω–æ –æ—Ç–∫—Ä—ã—Ç—å –∫–∞—Ä—Ç–æ—á–∫–∏

### 1. **–õ–∏–¥–µ—Ä–±–æ—Ä–¥** (–≥–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞)
- –ö–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ –∏–º—è –ª—é–±–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ —Å–ø–∏—Å–∫–µ –ª–∏–¥–µ—Ä–æ–≤
- –û—Ç–∫—Ä–æ–µ—Ç—Å—è –∫–∞—Ä—Ç–æ—á–∫–∞ —Å **–ø–æ–ª–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π**

### 2. **–ö–æ–º–ø–æ–Ω–µ–Ω—Ç Leaderboard**
- –í –¥–µ—Ç–∞–ª—å–Ω–æ–º –ª–∏–¥–µ—Ä–±–æ—Ä–¥–µ –∫–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –∏–∫–æ–Ω–∫–∞ üë§ –¥–ª—è –∫–ª–∏–∫–∞–±–µ–ª—å–Ω—ã—Ö –∏–º–µ–Ω

### 3. **–ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è** (–±—É–¥—É—â–µ–µ)
- –í —Å–ø–∏—Å–∫–∞—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤
- –í –ª–æ–≥–∞—Ö –º–æ–¥–µ—Ä–∞—Ç–æ—Ä–∞
- –í –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã—Ö –ø–∞–Ω–µ–ª—è—Ö

## üõ† –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

#### `UserProfileModal`
```tsx
<UserProfileModal
  userId="user-uuid"
  isOpen={true}
  onClose={() => {}}
  showFullStats={true} // true –¥–ª—è –ø–æ–ª–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
/>
```

#### `useUserProfileModal` —Ö—É–∫
```tsx
const { 
  userId, 
  isOpen, 
  showFullStats, 
  openProfile, 
  closeProfile 
} = useUserProfileModal()

// –û—Ç–∫—Ä—ã—Ç—å –ø—Ä–æ—Ñ–∏–ª—å —Å –±–∞–∑–æ–≤–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π
openProfile("user-uuid", false)

// –û—Ç–∫—Ä—ã—Ç—å –ø—Ä–æ—Ñ–∏–ª—å —Å –ø–æ–ª–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π
openProfile("user-uuid", true)
```

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å (RLS)

#### –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –ø–æ–ª–∏—Ç–∏–∫–∏
```sql
-- –ë–∞–∑–æ–≤–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –¥–æ—Å—Ç—É–ø–Ω–∞ –≤—Å–µ–º –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º
CREATE POLICY "Users can view basic profile info" ON public.user_profiles
    FOR SELECT USING (auth.role() = 'authenticated');

-- Email –¥–æ—Å—Ç—É–ø–µ–Ω —Ç–æ–ª—å–∫–æ –≤–ª–∞–¥–µ–ª—å—Ü—É –∏–ª–∏ –∞–¥–º–∏–Ω—É
-- –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ —á–µ—Ä–µ–∑ —Ñ—É–Ω–∫—Ü–∏—é get_user_profile_safe()
```

#### –ë–µ–∑–æ–ø–∞—Å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
- `get_user_profile_safe(user_id)` - –ø–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –ø—Ä–∞–≤
- `get_user_stats_safe(user_id)` - –ø–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –ø—Ä–∞–≤

## üì± –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å

### –î–∏–∑–∞–π–Ω
- **–ü–∏–∫—Å–µ–ª—å–Ω—ã–π —Å—Ç–∏–ª—å** –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å –æ–±—â–µ–π —Ç–µ–º–æ–π
- **–ì—Ä–∞–¥–∏–µ–Ω—Ç–Ω—ã–µ —Ñ–æ–Ω—ã** –¥–ª—è –≤–∏–∑—É–∞–ª—å–Ω–æ–π –ø—Ä–∏–≤–ª–µ–∫–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- **–ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π –¥–∏–∑–∞–π–Ω** –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ä–∞–∑–º–µ—Ä–æ–≤ —ç–∫—Ä–∞–Ω–∞
- **–ê–Ω–∏–º–∞—Ü–∏–∏** –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ –∏ –ø–µ—Ä–µ—Ö–æ–¥–∞—Ö

### –≠–ª–µ–º–µ–Ω—Ç—ã –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
- **–ê–≤–∞—Ç–∞—Ä** —Å –∏–Ω–∏—Ü–∏–∞–ª–∞–º–∏ –∫–∞–∫ fallback
- **–°—Ç–∞—Ç—É—Å –æ–Ω–ª–∞–π–Ω** (–∑–µ–ª–µ–Ω—ã–π/—Å–µ—Ä—ã–π –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä)
- **–ë–µ–π–¥–∂–∏** –¥–ª—è –¥–æ–ª–∂–Ω–æ—Å—Ç–∏ –∏ –æ—Ñ–∏—Å–∞
- **–í–∫–ª–∞–¥–∫–∏** –¥–ª—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
- **–°—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∏–µ –∫–∞—Ä—Ç–æ—á–∫–∏** —Å –∏–∫–æ–Ω–∫–∞–º–∏

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ

### 1. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
```bash
# –í—ã–ø–æ–ª–Ω–∏—Ç–µ SQL —Å–∫—Ä–∏–ø—Ç –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è RLS –ø–æ–ª–∏—Ç–∏–∫
psql -f update-user-visibility-rls.sql
```

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ—É–Ω–∫—Ü–∏–π
```sql
-- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–π
SELECT * FROM get_user_profile_safe('user-uuid');
SELECT * FROM get_user_stats_safe('user-uuid');
```

### 3. –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –¥–æ–±–∞–≤–ª–µ–Ω—ã —Ñ–∞–π–ª—ã:
- `components/user-profile-modal.tsx`
- `hooks/use-user-profile-modal.ts`

## üé® –ö–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏—è

### –ò–∑–º–µ–Ω–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º—ã—Ö –ø–æ–ª–µ–π
–í `UserProfileModal` –º–æ–∂–Ω–æ –ª–µ–≥–∫–æ –¥–æ–±–∞–≤–∏—Ç—å/—É–±—Ä–∞—Ç—å –ø–æ–ª—è:

```tsx
// –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤–æ–µ –ø–æ–ª–µ
{userData.department && (
  <div className="flex items-center gap-2 text-sm text-muted-foreground">
    <Building className="w-4 h-4" />
    –û—Ç–¥–µ–ª: {userData.department}
  </div>
)}
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–µ
```tsx
// –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –ø–æ–ª–Ω—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É —Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∞–º
const showStats = currentUser?.is_admin || currentUser?.id === userId
openProfile(userId, showStats)
```

## üîÆ –ü–ª–∞–Ω—ã —Ä–∞–∑–≤–∏—Ç–∏—è

### –ë–ª–∏–∂–∞–π—à–∏–µ —É–ª—É—á—à–µ–Ω–∏—è
1. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å** - –∫–∞—Ä—Ç–æ—á–∫–∏ –≤ –ª–æ–≥–∞—Ö –º–æ–¥–µ—Ä–∞—Ç–æ—Ä–∞
2. **–°–∏—Å—Ç–µ–º–∞ —Å–æ–æ–±—â–µ–Ω–∏–π** - –æ—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π —á–µ—Ä–µ–∑ –∫–∞—Ä—Ç–æ—á–∫—É
3. **–†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞** - –≥—Ä–∞—Ñ–∏–∫–∏ –∏ –¥–∏–∞–≥—Ä–∞–º–º—ã
4. **–°–∏—Å—Ç–µ–º–∞ —Ä–µ–π—Ç–∏–Ω–≥–æ–≤** - –æ—Ü–µ–Ω–∫–∏ –∫–æ–ª–ª–µ–≥

### –î–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã–µ –ø–ª–∞–Ω—ã
1. **–ú–æ–±–∏–ª—å–Ω–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è** - —É–ª—É—á—à–µ–Ω–Ω—ã–π UX –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞—Ö
2. **–°–æ—Ü–∏–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏** - –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∏ –ª–∞–π–∫–∏
3. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –∫–∞–ª–µ–Ω–¥–∞—Ä–µ–º** - –ø–æ–∫–∞–∑ —Ä–∞–±–æ—á–µ–≥–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è
4. **–°–∏—Å—Ç–µ–º–∞ –Ω–∞—Å—Ç–∞–≤–Ω–∏—á–µ—Å—Ç–≤–∞** - —Å–≤—è–∑—å –æ–ø—ã—Ç–Ω—ã—Ö –∏ –Ω–æ–≤—ã—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤

## üêõ –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

1. **Email –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å** - —Ç—Ä–µ–±—É–µ—Ç –ø—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∞ –∏–ª–∏ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π –ø—Ä–æ—Ñ–∏–ª—å
2. **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞** - –º–æ–∂–µ—Ç –±—ã—Ç—å –º–µ–¥–ª–µ–Ω–Ω–æ–π –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –±–æ–ª—å—à–∏–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –∑–∞–¥–∞—á
3. **–ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ** - –¥–∞–Ω–Ω—ã–µ –º–æ–≥—É—Ç –±—ã—Ç—å –Ω–µ –≤—Å–µ–≥–¥–∞ –∞–∫—Ç—É–∞–ª—å–Ω—ã–º–∏ (–æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏)

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ RLS –ø–æ–ª–∏—Ç–∏–∫–∏ –≤ Supabase
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ñ—É–Ω–∫—Ü–∏–∏ `get_user_profile_safe` –∏ `get_user_stats_safe` —Å–æ–∑–¥–∞–Ω—ã
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**–ö–æ–Ω—Ç–∞–∫—Ç –¥–ª—è —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–π –ø–æ–¥–¥–µ—Ä–∂–∫–∏**: egordolgih@mail.ru

---

*–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞: –î–µ–∫–∞–±—Ä—å 2024*
*–í–µ—Ä—Å–∏—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏: 1.0* 