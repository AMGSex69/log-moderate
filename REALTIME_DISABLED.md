# üöÄ –û—Ç–∫–ª—é—á–µ–Ω–∏–µ Realtime —Ñ—É–Ω–∫—Ü–∏–π –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

## ‚úÖ –ß—Ç–æ –±—ã–ª–æ –æ—Ç–∫–ª—é—á–µ–Ω–æ

### 1. **–û–Ω–ª–∞–π–Ω —Å—Ç–∞—Ç—É—Å—ã —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤**
- ‚ùå `authService.updateOnlineStatus()` - –±–æ–ª—å—à–µ –Ω–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å—Ç–∞—Ç—É—Å
- ‚ùå `DatabaseService.updateEmployeeOnlineStatus()` - –æ—Ç–∫–ª—é—á–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è
- ‚ùå –ü–æ–ª–µ `is_online` –±–æ–ª—å—à–µ –Ω–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

### 2. **Heartbeat —Å–∏—Å—Ç–µ–º–∞ –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å–µ—Å—Å–∏–π**
- ‚ùå `updateActiveSessionHeartbeat()` - –æ—Ç–∫–ª—é—á–µ–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫
- ‚ùå `setInterval(updateHeartbeat, 30000)` - —É–±—Ä–∞–Ω—ã –≤—Å–µ heartbeat –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã
- ‚ùå –ü–æ–ª–µ `last_heartbeat` –±–æ–ª—å—à–µ –Ω–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è

### 3. **Real-time –ø–æ–¥–ø–∏—Å–∫–∏**
- ‚ùå `supabase.channel().on("postgres_changes")` - —É–±—Ä–∞–Ω—ã –≤—Å–µ subscriptions
- ‚ùå –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –∞–∫—Ç–∏–≤–Ω—ã—Ö –∫–æ–ª–ª–µ–≥
- ‚ùå Real-time —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö –≤ active_sessions

### 4. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è**
- ‚ùå `setInterval(fetchActiveColleagues, 10000)` - –∫–∞–∂–¥—ã–µ 10 —Å–µ–∫
- ‚ùå `setInterval(loadWorkingEmployees, 30000)` - –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫
- ‚ùå `setInterval(updateHeartbeat, 30000)` - –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫

### 5. **–ü–æ–∫–∞–∑ –∞–∫—Ç–∏–≤–Ω—ã—Ö –∫–æ–ª–ª–µ–≥**
- ‚ùå `fetchActiveColleagues()` - –≤—Å–µ–≥–¥–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø—É—Å—Ç–æ–π –º–∞—Å—Å–∏–≤
- ‚ùå –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –±–æ–ª—å—à–µ –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç "–∫—Ç–æ —Å–µ–π—á–∞—Å —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞–¥ –∑–∞–¥–∞—á–µ–π"

### 6. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ —Å–µ—Å—Å–∏–π**
- ‚ùå `cleanupIdleSessions()` - –æ—Ç–∫–ª—é—á–µ–Ω–∞ –∞–≤—Ç–æ–æ—á–∏—Å—Ç–∫–∞ –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã—Ö —Å–µ—Å—Å–∏–π
- ‚ùå –ü—Ä–æ–≤–µ—Ä–∫–∞ timeout –¥–ª—è "–º–µ—Ä—Ç–≤—ã—Ö" —Å–µ—Å—Å–∏–π

## üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç

### **–°–Ω–∏–∂–µ–Ω–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö:**
- **–ë—ã–ª–æ:** 100+ UPDATE –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –º–∏–Ω—É—Ç—É –Ω–∞ 50 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- **–°—Ç–∞–ª–æ:** 0 –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö UPDATE –∑–∞–ø—Ä–æ—Å–æ–≤

### **–°–Ω–∏–∂–µ–Ω–∏–µ realtime –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π:**
- **–ë—ã–ª–æ:** –ö–∞–∂–¥—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å = 2-3 WebSocket –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
- **–°—Ç–∞–ª–æ:** 0 –ø–æ—Å—Ç–æ—è–Ω–Ω—ã—Ö WebSocket –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π

### **–£–ª—É—á—à–µ–Ω–∏–µ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç–∏:**
- **–ö–æ–º—Ñ–æ—Ä—Ç–Ω–∞—è —Ä–∞–±–æ—Ç–∞:** 50-100 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (–±—ã–ª–æ 20-50)
- **–†–∞–±–æ—Ç–∞ —Å –¥–µ–≥—Ä–∞–¥–∞—Ü–∏–µ–π:** 100-200 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (–±—ã–ª–æ 50-100)
- **–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π –ª–∏–º–∏—Ç:** 200+ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (–±—ã–ª–æ 100)

## üìã –ß—Ç–æ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å

### ‚úÖ **–û—Å–Ω–æ–≤–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª —Å–æ—Ö—Ä–∞–Ω–µ–Ω:**
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é
- –†–∞–±–æ—á–∏–µ —Å–º–µ–Ω—ã –æ—Ç—Å–ª–µ–∂–∏–≤–∞—é—Ç—Å—è
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ —Ä–∞–±–æ—Ç–∞—é—Ç
- –ú–Ω–æ–≥–æ–∑–∞–¥–∞—á–Ω–æ—Å—Ç—å —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∏—Ä—É–µ—Ç
- –ò–≥—Ä–æ—Ñ–∏–∫–∞—Ü–∏—è –∞–∫—Ç–∏–≤–Ω–∞

### ‚úÖ **–î–∞–Ω–Ω—ã–µ –æ—Å—Ç–∞—é—Ç—Å—è –∞–∫—Ç—É–∞–ª—å–Ω—ã–º–∏:**
- –ü—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –¥–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –∏–∑ –ë–î
- –†—É—á–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- –í—Å–µ CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∏—Ä—É—é—Ç

## üîß –§–∞–π–ª—ã —Å –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏

### **Hooks:**
- `hooks/use-active-sessions.ts` - –æ—Ç–∫–ª—é—á–µ–Ω—ã subscriptions –∏ heartbeat
- `hooks/use-multi-timer.ts` - —É–±—Ä–∞–Ω—ã –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–µ—Å—Å–∏–π

### **Services:**
- `lib/auth.ts` - –æ—Ç–∫–ª—é—á–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `updateOnlineStatus()`
- `lib/database-service.ts` - –æ—Ç–∫–ª—é—á–µ–Ω—ã –≤—Å–µ heartbeat –º–µ—Ç–æ–¥—ã

### **Components:**
- `components/work-session-enhanced.tsx` - —É–±—Ä–∞–Ω—ã –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
- `components/work-session-controls.tsx` - –æ—Ç–∫–ª—é—á–µ–Ω—ã –æ–Ω–ª–∞–π–Ω —Å—Ç–∞—Ç—É—Å—ã

## üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–≥–æ —Ä–∞–∑–≤–∏—Ç–∏—è

### **–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å realtime:**
1. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Server-Sent Events –≤–º–µ—Å—Ç–æ WebSocket
2. –ì—Ä—É–ø–ø–∏—Ä—É–π—Ç–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤ –±–∞—Ç—á–∏
3. –î–æ–±–∞–≤—å—Ç–µ debouncing –¥–ª—è —á–∞—Å—Ç—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
4. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ —É—Ä–æ–≤–Ω–µ CDN

### **–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è:**
1. **Polling —Å —É–≤–µ–ª–∏—á–µ–Ω–Ω—ã–º–∏ –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞–º–∏** (5-10 –º–∏–Ω—É—Ç)
2. **Push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è** –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π
3. **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ** —Å TTL –¥–ª—è —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö
4. **Lazy loading** –¥–ª—è –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

## üéâ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–û—Ç–∫–ª—é—á–µ–Ω–∏–µ realtime —Ñ—É–Ω–∫—Ü–∏–π **–∫–∞—Ä–¥–∏–Ω–∞–ª—å–Ω–æ —É–ª—É—á—à–∏–ª–æ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** –ø—Ä–æ–µ–∫—Ç–∞:
- –°–Ω–∏–∂–µ–Ω–∞ –Ω–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –≤ **10+ —Ä–∞–∑**
- –£–±—Ä–∞–Ω—ã –ø–æ—Å—Ç–æ—è–Ω–Ω—ã–µ WebSocket –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
- –£–≤–µ–ª–∏—á–µ–Ω–∞ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å –≤ **2-4 —Ä–∞–∑–∞**
- –°–æ—Ö—Ä–∞–Ω–µ–Ω –≤–µ—Å—å –æ—Å–Ω–æ–≤–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª

–ü—Ä–æ–µ–∫—Ç —Ç–µ–ø–µ—Ä—å –º–æ–∂–µ—Ç –∫–æ–º—Ñ–æ—Ä—Ç–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å —Å **50-100 –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏** –≤–º–µ—Å—Ç–æ –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö 20-50. 