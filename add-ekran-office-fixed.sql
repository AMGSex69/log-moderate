-- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –æ—Ñ–∏—Å–∞ "–≠–∫—Ä–∞–Ω" –¥–ª—è –æ–∫—Ä—É–≥–∞ –Æ–í–ê–û (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è)
-- –°–æ –≤—Å–µ–º–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ –∏ –ª–æ–≥–∏–∫–æ–π

BEGIN;

-- 1. –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–π –æ—Ñ–∏—Å (–∏—Å–ø–æ–ª—å–∑—É–µ–º districts –∫–∞–∫ –º–∞—Å—Å–∏–≤)
INSERT INTO offices (name, description, districts, created_at, updated_at)
VALUES ('–≠–∫—Ä–∞–Ω', '–û—Ñ–∏—Å –≠–∫—Ä–∞–Ω –≤ –æ–∫—Ä—É–≥–µ –Æ–í–ê–û', ARRAY['–Æ–í–ê–û'], NOW(), NOW())
ON CONFLICT (name) DO NOTHING;

-- –ü–æ–ª—É—á–∞–µ–º ID –Ω–æ–≤–æ–≥–æ –æ—Ñ–∏—Å–∞
DO $$
DECLARE
    new_office_id INTEGER;
BEGIN
    SELECT id INTO new_office_id FROM offices WHERE name = '–≠–∫—Ä–∞–Ω';
    
    -- 2. –ü—Ä–æ–≤–µ—Ä—è–µ–º –µ—Å—Ç—å –ª–∏ —Ç–∞–±–ª–∏—Ü–∞ work_schedules
    IF EXISTS (SELECT 1 FROM information_schema.tables WHERE table_name = 'work_schedules') THEN
        -- –î–æ–±–∞–≤–ª—è–µ–º —Ä–∞–±–æ—á–∏–µ –≥—Ä–∞—Ñ–∏–∫–∏ –¥–ª—è –Ω–æ–≤–æ–≥–æ –æ—Ñ–∏—Å–∞
        INSERT INTO work_schedules (name, description, work_hours, office_id, is_active, created_at, updated_at)
        VALUES 
            ('5/2 (9—á)', '–ü—è—Ç–∏–¥–Ω–µ–≤–∫–∞ —Å 9-—á–∞—Å–æ–≤—ã–º —Ä–∞–±–æ—á–∏–º –¥–Ω–µ–º', 9, new_office_id, true, NOW(), NOW()),
            ('2/2 (12—á)', '–î–≤—É—Ö–¥–Ω–µ–≤–∫–∞ —Å 12-—á–∞—Å–æ–≤—ã–º —Ä–∞–±–æ—á–∏–º –¥–Ω–µ–º', 12, new_office_id, true, NOW(), NOW())
        ON CONFLICT (name, office_id) DO NOTHING;
        RAISE NOTICE '–†–∞–±–æ—á–∏–µ –≥—Ä–∞—Ñ–∏–∫–∏ –¥–æ–±–∞–≤–ª–µ–Ω—ã –¥–ª—è –æ—Ñ–∏—Å–∞ –≠–∫—Ä–∞–Ω';
    ELSE
        RAISE NOTICE '–¢–∞–±–ª–∏—Ü–∞ work_schedules –Ω–µ –Ω–∞–π–¥–µ–Ω–∞, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–æ–≤';
    END IF;
    
    -- 3. –î–æ–±–∞–≤–ª—è–µ–º —Ç–∏–ø—ã –∑–∞–¥–∞—á –¥–ª—è –Ω–æ–≤–æ–≥–æ –æ—Ñ–∏—Å–∞ (–∏—Å–ø–æ–ª—å–∑—É–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É task_types)
    INSERT INTO task_types (name, description, is_active, created_at, measurement_unit, group_name, icon, color)
    VALUES 
        ('–ü—Ä–∏–µ–º/–í—ã–¥–∞—á–∞ (–≠–∫—Ä–∞–Ω)', '–ü—Ä–∏–µ–º –∏ –≤—ã–¥–∞—á–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –≤ –æ—Ñ–∏—Å–µ –≠–∫—Ä–∞–Ω', true, NOW(), '–¥–æ–∫—É–º–µ–Ω—Ç–æ–≤', '–≠–∫—Ä–∞–Ω', 'üìÑ', '#3B82F6'),
        ('–ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è (–≠–∫—Ä–∞–Ω)', '–ö–æ–Ω—Å—É–ª—å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≥—Ä–∞–∂–¥–∞–Ω –≤ –æ—Ñ–∏—Å–µ –≠–∫—Ä–∞–Ω', true, NOW(), '–∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–π', '–≠–∫—Ä–∞–Ω', 'üí¨', '#10B981'),
        ('–û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ (–≠–∫—Ä–∞–Ω)', '–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∏ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –≤ –æ—Ñ–∏—Å–µ –≠–∫—Ä–∞–Ω', true, NOW(), '–¥–æ–∫—É–º–µ–Ω—Ç–æ–≤', '–≠–∫—Ä–∞–Ω', 'üìù', '#F59E0B'),
        ('–ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ (–≠–∫—Ä–∞–Ω)', '–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç–∏ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –≤ –æ—Ñ–∏—Å–µ –≠–∫—Ä–∞–Ω', true, NOW(), '–¥–æ–∫—É–º–µ–Ω—Ç–æ–≤', '–≠–∫—Ä–∞–Ω', 'üîç', '#8B5CF6'),
        ('–†–∞–±–æ—Ç–∞ —Å –±–∞–∑–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö (–≠–∫—Ä–∞–Ω)', '–í–Ω–µ—Å–µ–Ω–∏–µ –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö –≤ –æ—Ñ–∏—Å–µ –≠–∫—Ä–∞–Ω', true, NOW(), '–∑–∞–ø–∏—Å–µ–π', '–≠–∫—Ä–∞–Ω', 'üíæ', '#EF4444'),
        ('–¢–µ–ª–µ—Ñ–æ–Ω–Ω—ã–µ –∑–≤–æ–Ω–∫–∏ (–≠–∫—Ä–∞–Ω)', '–û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Ö–æ–¥—è—â–∏—Ö –∑–≤–æ–Ω–∫–æ–≤ –≤ –æ—Ñ–∏—Å–µ –≠–∫—Ä–∞–Ω', true, NOW(), '–∑–≤–æ–Ω–∫–æ–≤', '–≠–∫—Ä–∞–Ω', 'üìû', '#06B6D4'),
        ('–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –æ—Ç—á–µ—Ç–æ–≤ (–≠–∫—Ä–∞–Ω)', '–°–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –æ—Ç—á–µ—Ç–Ω–æ—Å—Ç–∏ –≤ –æ—Ñ–∏—Å–µ –≠–∫—Ä–∞–Ω', true, NOW(), '–æ—Ç—á–µ—Ç–æ–≤', '–≠–∫—Ä–∞–Ω', 'üìä', '#84CC16'),
        ('–ú–µ–∂–≤–µ–¥–æ–º—Å—Ç–≤–µ–Ω–Ω–æ–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ (–≠–∫—Ä–∞–Ω)', '–†–∞–±–æ—Ç–∞ —Å –¥—Ä—É–≥–∏–º–∏ –≤–µ–¥–æ–º—Å—Ç–≤–∞–º–∏ –≤ –æ—Ñ–∏—Å–µ –≠–∫—Ä–∞–Ω', true, NOW(), '–æ–±—Ä–∞—â–µ–Ω–∏–π', '–≠–∫—Ä–∞–Ω', 'ü§ù', '#F97316'),
        ('–û–±—É—á–µ–Ω–∏–µ/–ò–Ω—Å—Ç—Ä—É–∫—Ç–∞–∂ (–≠–∫—Ä–∞–Ω)', '–£—á–∞—Å—Ç–∏–µ –≤ –æ–±—É—á–∞—é—â–∏—Ö –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è—Ö –≤ –æ—Ñ–∏—Å–µ –≠–∫—Ä–∞–Ω', true, NOW(), '—á–∞—Å–æ–≤', '–≠–∫—Ä–∞–Ω', 'üéì', '#EC4899'),
        ('–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ (–≠–∫—Ä–∞–Ω)', '–†–µ—à–µ–Ω–∏–µ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏—Ö –≤–æ–ø—Ä–æ—Å–æ–≤ –≤ –æ—Ñ–∏—Å–µ –≠–∫—Ä–∞–Ω', true, NOW(), '–∏–Ω—Ü–∏–¥–µ–Ω—Ç–æ–≤', '–≠–∫—Ä–∞–Ω', 'üîß', '#6B7280')
    ON CONFLICT (name) DO NOTHING;
    
    RAISE NOTICE '–û—Ñ–∏—Å "–≠–∫—Ä–∞–Ω" —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω —Å ID: %', new_office_id;
END $$;

-- 4. –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ–∑–¥–∞–Ω–Ω—ã–π –æ—Ñ–∏—Å
SELECT 
    o.id,
    o.name,
    o.description,
    o.districts,
    COUNT(DISTINCT tt.id) as task_types_count
FROM offices o
LEFT JOIN task_types tt ON tt.group_name = '–≠–∫—Ä–∞–Ω'
WHERE o.name = '–≠–∫—Ä–∞–Ω'
GROUP BY o.id, o.name, o.description, o.districts;

-- 5. –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—Å–µ —Ç–∏–ø—ã –∑–∞–¥–∞—á –¥–ª—è –Ω–æ–≤–æ–≥–æ –æ—Ñ–∏—Å–∞
SELECT 
    tt.id,
    tt.name,
    tt.description,
    tt.measurement_unit,
    tt.group_name,
    tt.icon,
    tt.color
FROM task_types tt
WHERE tt.group_name = '–≠–∫—Ä–∞–Ω'
ORDER BY tt.name;

-- 6. –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—Å–µ –æ—Ñ–∏—Å—ã
SELECT 
    id,
    name,
    description,
    districts
FROM offices
ORDER BY name;

COMMIT;

-- –ò—Ç–æ–≥–æ–≤–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
SELECT '–û—Ñ–∏—Å "–≠–∫—Ä–∞–Ω" (–Æ–í–ê–û) —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω —Å–æ –≤—Å–µ–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏!' as result; 