# üöÄ –ë—ã—Å—Ç—Ä–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–≤—Ç–æ–∑–∞–∫—Ä—ã—Ç–∏—è –∑–∞–¥–∞—á

## –ü—Ä–æ–±–ª–µ–º–∞
‚úÖ –†–∞–±–æ—á–∏–π –¥–µ–Ω—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è –≤ 00:00  
‚ùå –ê–∫—Ç–∏–≤–Ω—ã–µ –∑–∞–¥–∞—á–∏ –æ—Å—Ç–∞—é—Ç—Å—è "–∑–∞–≤–∏—Å—à–∏–º–∏"

## –†–µ—à–µ–Ω–∏–µ (2 –º–∏–Ω—É—Ç—ã)

### 1. –û—Ç–∫—Ä–æ–π—Ç–µ Supabase Dashboard
- –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ SQL Editor

### 2. –ò—Å–ø—Ä–∞–≤—å—Ç–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ë–î (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
–ï—Å–ª–∏ –ø–æ–ª—É—á–∞–µ—Ç–µ –æ—à–∏–±–∫—É "there is no unique constraint", –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:
`fix-work-sessions-simple.sql` (–ø—Ä–æ—Å—Ç–∞—è –≤–µ—Ä—Å–∏—è) –∏–ª–∏
`fix-work-sessions-unique-constraint.sql` (–ø–æ–ª–Ω–∞—è –≤–µ—Ä—Å–∏—è)

### 3. –í—ã–ø–æ–ª–Ω–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è
–°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞ `auto-close-workday-with-tasks.sql`

### 4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç
–í—ã–ø–æ–ª–Ω–∏—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç `test-auto-close-system.sql`

## –ß—Ç–æ –∏—Å–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è

| –î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è | –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è |
|---------------|-------------------|
| ‚ùå –ó–∞–¥–∞—á–∏ "–≤–∏—Å—è—Ç" –ø–æ—Å–ª–µ –ø–æ–ª—É–Ω–æ—á–∏ | ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–∫—Ä—ã–≤–∞—é—Ç—Å—è |
| ‚ùå –¢–∞–π–º–µ—Ä—ã –ø—Ä–æ–¥–æ–ª–∂–∞—é—Ç —Ä–∞–±–æ—Ç–∞—Ç—å | ‚úÖ –°–±—Ä–∞—Å—ã–≤–∞—é—Ç—Å—è –≤ 00:00 |
| ‚ùå –ò—Å–∫–∞–∂–µ–Ω–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ | ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ |

## –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫

–î–æ–±–∞–≤—å—Ç–µ –≤ Supabase SQL Editor:
```sql
-- –ó–∞–ø—É—Å–∫ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 00:00
SELECT cron.schedule('auto-close-workday', '0 0 * * *', 'SELECT auto_close_workday_and_tasks();');
```

## –ü—Ä–æ–≤–µ—Ä–∫–∞

–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å `0`:
```sql
-- –ü—Ä–æ–≤–µ—Ä–∫–∞ 1: –ù–µ—Ç —Å—Ç–∞—Ä—ã—Ö –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–¥–∞—á  
SELECT COUNT(*) FROM active_sessions 
WHERE is_active = true AND DATE(started_at) < CURRENT_DATE;

-- –ü—Ä–æ–≤–µ—Ä–∫–∞ 2: –ù–µ—Ç –Ω–µ–∑–∞–∫—Ä—ã—Ç—ã—Ö —Ä–∞–±–æ—á–∏—Ö –¥–Ω–µ–π
SELECT COUNT(*) FROM work_sessions 
WHERE date < CURRENT_DATE 
AND clock_in_time IS NOT NULL 
AND clock_out_time IS NULL;
```

---
**–°—Ç–∞—Ç—É—Å**: ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—é  
**–í—Ä–µ–º—è**: ~2 –º–∏–Ω—É—Ç—ã  
**–†–∏—Å–∫**: –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π (—Ç–æ–ª—å–∫–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–æ–≤) 