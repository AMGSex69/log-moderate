# ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–ê–Ø –ü–û–°–õ–ï–î–û–í–ê–¢–ï–õ–¨–ù–û–°–¢–¨ –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø

## ‚ùå –ß–¢–û –ü–û–®–õ–û –ù–ï –¢–ê–ö:
–í—ã –≤—ã–ø–æ–ª–Ω–∏–ª–∏ —Ñ–∞–π–ª `fix-auth-registration.sql`, –∫–æ—Ç–æ—Ä—ã–π —Å–æ–¥–µ—Ä–∂–∏—Ç —Å—Ç–∞—Ä—ã–π –∫–æ–¥ —Å –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –∫–æ–ª–æ–Ω–∫–æ–π `measurement_unit`.

## ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–ê–Ø –ü–û–°–õ–ï–î–û–í–ê–¢–ï–õ–¨–ù–û–°–¢–¨:

### 1Ô∏è‚É£ **–¢–û–õ–¨–ö–û –¥–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ):**
```sql
-- –§–∞–π–ª: fix-work-sessions-simple.sql
-- –ö–æ–ø–∏—Ä—É–π—Ç–µ –¢–û–õ–¨–ö–û —ç—Ç–æ—Ç —Ñ–∞–π–ª –≤ Supabase SQL Editor
```

### 2Ô∏è‚É£ **–û—Å–Ω–æ–≤–Ω–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–≤—Ç–æ–∑–∞–∫—Ä—ã—Ç–∏—è:**
```sql
-- –§–∞–π–ª: auto-close-workday-with-tasks.sql
-- –ö–æ–ø–∏—Ä—É–π—Ç–µ –¢–û–õ–¨–ö–û —ç—Ç–æ—Ç —Ñ–∞–π–ª –≤ Supabase SQL Editor
```

### 3Ô∏è‚É£ **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):**
```sql
-- –§–∞–π–ª: test-auto-close-system.sql
-- –ö–æ–ø–∏—Ä—É–π—Ç–µ –¢–û–õ–¨–ö–û —ç—Ç–æ—Ç —Ñ–∞–π–ª –≤ Supabase SQL Editor
```

## üö´ **–ù–ï –í–´–ü–û–õ–ù–Ø–ô–¢–ï —ç—Ç–∏ —Ñ–∞–π–ª—ã:**
- ‚ùå `fix-auth-registration.sql` (—Å–æ–¥–µ—Ä–∂–∏—Ç –æ—à–∏–±–∫–∏)
- ‚ùå `fix-work-sessions-unique-constraint.sql` (—Å–ª–æ–∂–Ω–∞—è –≤–µ—Ä—Å–∏—è)
- ‚ùå –õ—é–±—ã–µ –¥—Ä—É–≥–∏–µ SQL —Ñ–∞–π–ª—ã –∏–∑ –ø—Ä–æ–µ–∫—Ç–∞

## üéØ **–°–ï–ô–ß–ê–° –í–´–ü–û–õ–ù–ò–¢–ï:**

### –®–∞–≥ 1: –ò—Å–ø—Ä–∞–≤–∏—Ç—å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è
```sql
-- –ö–û–ü–ò–†–£–ô–¢–ï –í SUPABASE SQL EDITOR:

-- –ü–†–û–°–¢–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —É–Ω–∏–∫–∞–ª—å–Ω–æ–≥–æ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –¥–ª—è work_sessions
-- –≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ –¥–æ–±–∞–≤–ª—è–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω–æ–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ

-- 1. –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
SELECT '–¢–µ–∫—É—â–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –Ω–∞ work_sessions:' as info;
SELECT 
    constraint_name, 
    constraint_type
FROM information_schema.table_constraints 
WHERE table_name = 'work_sessions';

-- 2. –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥—É–±–ª–∏–∫–∞—Ç—ã
SELECT '–ü—Ä–æ–≤–µ—Ä–∫–∞ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤:' as info;
SELECT 
    employee_id, 
    date, 
    COUNT(*) as count
FROM work_sessions 
GROUP BY employee_id, date 
HAVING COUNT(*) > 1;

-- 3. –£–¥–∞–ª—è–µ–º –¥—É–±–ª–∏–∫–∞—Ç—ã –µ—Å–ª–∏ –µ—Å—Ç—å
DELETE FROM work_sessions w1
WHERE w1.id NOT IN (
    SELECT MIN(w2.id)
    FROM work_sessions w2
    WHERE w2.employee_id = w1.employee_id 
    AND w2.date = w1.date
);

-- 4. –î–æ–±–∞–≤–ª—è–µ–º —É–Ω–∏–∫–∞–ª—å–Ω–æ–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ
ALTER TABLE work_sessions 
ADD CONSTRAINT work_sessions_employee_date_unique 
UNIQUE (employee_id, date);

-- 5. –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
SELECT '–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ —É—Å–ø–µ—à–Ω–æ!' as result;
SELECT 
    constraint_name, 
    constraint_type
FROM information_schema.table_constraints 
WHERE table_name = 'work_sessions'
AND constraint_type = 'UNIQUE';
```

### –®–∞–≥ 2: –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –®–∞–≥–∞ 1
–ü–µ—Ä–µ—Ö–æ–¥–∏—Ç–µ –∫ —Ñ–∞–π–ª—É `auto-close-workday-with-tasks.sql`

## üîç **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞:**
–ü–æ—Å–ª–µ –®–∞–≥–∞ 1 –≤—ã –¥–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å:
```
constraint_name: work_sessions_employee_date_unique
constraint_type: UNIQUE
```

## ‚ö†Ô∏è **–ï—Å–ª–∏ –ø–æ–ª—É—á–∞–µ—Ç–µ –æ—à–∏–±–∫–∏:**
1. –ù–µ –≤—ã–ø–æ–ª–Ω—è–π—Ç–µ –¥—Ä—É–≥–∏–µ SQL —Ñ–∞–π–ª—ã –∏–∑ –ø—Ä–æ–µ–∫—Ç–∞
2. –†–∞–±–æ—Ç–∞–π—Ç–µ —Ç–æ–ª—å–∫–æ —Å –Ω–∞—à–∏–º–∏ 3 —Ñ–∞–π–ª–∞–º–∏
3. –í—ã–ø–æ–ª–Ω—è–π—Ç–µ —Å—Ç—Ä–æ–≥–æ –ø–æ –ø–æ—Ä—è–¥–∫—É

---
**–ì–õ–ê–í–ù–û–ï**: –ò–≥–Ω–æ—Ä–∏—Ä—É–π—Ç–µ –≤—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ SQL —Ñ–∞–π–ª—ã, —Ä–∞–±–æ—Ç–∞–π—Ç–µ —Ç–æ–ª—å–∫–æ —Å –Ω–∞—à–∏–º–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è–º–∏! 