# üõ†Ô∏è –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã —Å –∫–Ω–æ–ø–∫–æ–π "–ù–∞—á–∞—Ç—å —Ä–∞–±–æ—á–∏–π –¥–µ–Ω—å"

## üîç –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

–ö–Ω–æ–ø–∫–∞ "–ù–∞—á–∞—Ç—å —Ä–∞–±–æ—á–∏–π –¥–µ–Ω—å" –Ω–µ —Ä–µ–∞–≥–∏—Ä—É–µ—Ç –Ω–∞ –Ω–∞–∂–∞—Ç–∏–µ. –í –ª–æ–≥–∞—Ö –≤–∏–¥–Ω—ã —Å–ª–µ–¥—É—é—â–∏–µ –ø—Ä–æ–±–ª–µ–º—ã:

1. **–û—à–∏–±–∫–∞ 400** –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ `user_profiles` 
2. **–ü–æ—Å—Ç–æ—è–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞** —Ä–∞–±–æ—Ç–∞—é—â–∏—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ (—Ü–∏–∫–ª–∏—á–µ—Å–∫–∞—è)
3. **–°—Ç–∞—Ç—É—Å**: "–ù–µ —Ä–∞–±–æ—Ç–∞–µ—Ç" –Ω–µ –º–µ–Ω—è–µ—Ç—Å—è

## üìä –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

### –®–∞–≥ 1: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Supabase SQL Editor

–í—ã–ø–æ–ª–Ω–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç **`debug-work-session.sql`** –≤ Supabase SQL Editor:

```sql
-- –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø –∫ user_profiles
SELECT * FROM public.user_profiles WHERE id = auth.uid();

-- –ü—Ä–æ–≤–µ—Ä—è–µ–º employees
SELECT * FROM public.employees WHERE user_id = auth.uid();
```

### –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞

1. –û—Ç–∫—Ä–æ–π—Ç–µ **F12** ‚Üí **Console**
2. –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "–ù–∞—á–∞—Ç—å —Ä–∞–±–æ—á–∏–π –¥–µ–Ω—å"
3. –ò—â–∏—Ç–µ –ª–æ–≥–∏ —Å —ç–º–æ–¥–∑–∏:
   - üéØ handleClockIn
   - üîç employeeId
   - ‚ùå –æ—à–∏–±–∫–∏

### –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Network –≤–∫–ª–∞–¥–∫—É

1. **F12** ‚Üí **Network**
2. –§–∏–ª—å—Ç—Ä: **Fetch/XHR**
3. –ò—â–∏—Ç–µ –∑–∞–ø—Ä–æ—Å—ã –∫:
   - `user_profiles` (—Å—Ç–∞—Ç—É—Å 400?)
   - `work_sessions` (—Å—Ç–∞—Ç—É—Å?)

## üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ 1: RLS –ø–æ–ª–∏—Ç–∏–∫–∏ user_profiles

–í—ã–ø–æ–ª–Ω–∏—Ç–µ –≤ Supabase SQL Editor:

```sql
-- –£–¥–∞–ª—è–µ–º –ø—Ä–æ–±–ª–µ–º–Ω—ã–µ –ø–æ–ª–∏—Ç–∏–∫–∏
DROP POLICY IF EXISTS "Users can view own profile" ON public.user_profiles;
DROP POLICY IF EXISTS "Users can update own profile" ON public.user_profiles;
DROP POLICY IF EXISTS "Users can insert own profile" ON public.user_profiles;

-- –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –ø–æ–ª–∏—Ç–∏–∫–∏
CREATE POLICY "Users can view own profile" ON public.user_profiles
FOR SELECT USING (auth.uid() = id);

CREATE POLICY "Users can update own profile" ON public.user_profiles
FOR UPDATE USING (auth.uid() = id);

CREATE POLICY "Users can insert own profile" ON public.user_profiles
FOR INSERT WITH CHECK (auth.uid() = id);

-- –í–∫–ª—é—á–∞–µ–º RLS
ALTER TABLE public.user_profiles ENABLE ROW LEVEL SECURITY;
```

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ 2: –°–æ–∑–¥–∞–Ω–∏–µ –Ω–µ–¥–æ—Å—Ç–∞—é—â–µ–≥–æ –ø—Ä–æ—Ñ–∏–ª—è

–ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ `user_profiles`:

```sql
-- –°–æ–∑–¥–∞–µ–º –ø—Ä–æ—Ñ–∏–ª—å –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
INSERT INTO public.user_profiles (
    id, 
    full_name, 
    work_schedule, 
    work_hours,
    position,
    is_admin,
    created_at,
    updated_at
) VALUES (
    auth.uid(),
    COALESCE(
        (SELECT raw_user_meta_data->>'full_name' FROM auth.users WHERE id = auth.uid()),
        (SELECT email FROM auth.users WHERE id = auth.uid()),
        '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å'
    ),
    '8+1',
    8,
    '–°–æ—Ç—Ä—É–¥–Ω–∏–∫',
    false,
    NOW(),
    NOW()
) ON CONFLICT (id) DO NOTHING;
```

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ employees

```sql
-- –°–æ–∑–¥–∞–µ–º employee –µ—Å–ª–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç
INSERT INTO public.employees (
    user_id,
    full_name,
    position,
    work_schedule,
    work_hours,
    is_admin,
    created_at,
    updated_at
) VALUES (
    auth.uid(),
    COALESCE(
        (SELECT full_name FROM public.user_profiles WHERE id = auth.uid()),
        (SELECT raw_user_meta_data->>'full_name' FROM auth.users WHERE id = auth.uid()),
        '–°–æ—Ç—Ä—É–¥–Ω–∏–∫'
    ),
    '–°–æ—Ç—Ä—É–¥–Ω–∏–∫',
    '8+1',
    8,
    false,
    NOW(),
    NOW()
) ON CONFLICT (user_id) DO NOTHING;
```

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ 4: –û—á–∏—Å—Ç–∫–∞ –∫—ç—à–∞ Next.js

–í —Ç–µ—Ä–º–∏–Ω–∞–ª–µ:

```bash
# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ dev —Å–µ—Ä–≤–µ—Ä (Ctrl+C)
rd /s /q .next
npm run dev
```

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ 5: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

–£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ `.env.local` —Å–æ–¥–µ—Ä–∂–∏—Ç:

```env
NEXT_PUBLIC_SUPABASE_URL=–≤–∞—à_url
NEXT_PUBLIC_SUPABASE_ANON_KEY=–≤–∞—à_–∫–ª—é—á
```

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

1. **–û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É** (Ctrl+F5)
2. **–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É** "–ù–∞—á–∞—Ç—å —Ä–∞–±–æ—á–∏–π –¥–µ–Ω—å"
3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å**:
   - ‚úÖ "handleClockIn: –í—Å—ë —É—Å–ø–µ—à–Ω–æ!"
   - ‚úÖ "–†–∞–±–æ—á–∏–π –¥–µ–Ω—å –Ω–∞—á–∞—Ç!" toast
4. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ UI**:
   - –ö–Ω–æ–ø–∫–∞ –º–µ–Ω—è–µ—Ç—Å—è –Ω–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–º–µ–Ω–æ–π
   - –°—Ç–∞—Ç—É—Å: "–†–∞–±–æ—Ç–∞–µ—Ç"
   - –¢–∞–π–º–µ—Ä –Ω–∞—á–∏–Ω–∞–µ—Ç –∏–¥—Ç–∏

## üö® –ï—Å–ª–∏ –Ω–µ –ø–æ–º–æ–≥–ª–æ

### –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ - –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è

```sql
-- –°–æ–∑–¥–∞–µ–º –≤—Å—ë —Å –Ω—É–ª—è –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
BEGIN;

-- –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ –∑–∞–ø–∏—Å–∏
DELETE FROM public.work_sessions 
WHERE employee_id IN (SELECT id FROM public.employees WHERE user_id = auth.uid());

DELETE FROM public.employees WHERE user_id = auth.uid();
DELETE FROM public.user_profiles WHERE id = auth.uid();

-- –°–æ–∑–¥–∞–µ–º –∑–∞–Ω–æ–≤–æ
INSERT INTO public.user_profiles (id, full_name, work_schedule, work_hours, position, is_admin, created_at, updated_at)
VALUES (auth.uid(), '–¢–µ—Å—Ç–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å', '8+1', 8, '–°–æ—Ç—Ä—É–¥–Ω–∏–∫', false, NOW(), NOW());

INSERT INTO public.employees (user_id, full_name, position, work_schedule, work_hours, is_admin, created_at, updated_at)
VALUES (auth.uid(), '–¢–µ—Å—Ç–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å', '–°–æ—Ç—Ä—É–¥–Ω–∏–∫', '8+1', 8, false, NOW(), NOW());

COMMIT;
```

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –Ω–µ —Ä–µ—à–µ–Ω–∞:

1. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –ª–æ–≥–∏ –∏–∑ –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞
2. –°–¥–µ–ª–∞–π—Ç–µ —Å–∫—Ä–∏–Ω—à–æ—Ç Network –≤–∫–ª–∞–¥–∫–∏
3. –£–∫–∞–∂–∏—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã SQL —Å–∫—Ä–∏–ø—Ç–æ–≤

---

**üí° –°–æ–≤–µ—Ç**: –í—Å–µ–≥–¥–∞ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ –ø—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö —Å –∫–Ω–æ–ø–∫–∞–º–∏ - —Ç–∞–º –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –¥–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–æ–º, —á—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç. 