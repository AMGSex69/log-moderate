# Настройка Supabase для Task Logger

## Шаг 1: Создание проекта Supabase

1. Перейдите на [https://supabase.com](https://supabase.com)
2. Зарегистрируйтесь или войдите в существующий аккаунт
3. Нажмите "New Project"
4. Выберите организацию
5. Заполните данные проекта:
   - **Name**: `task-logger` (или любое другое имя)
   - **Database Password**: создайте надежный пароль и сохраните его
   - **Region**: выберите ближайший к вам регион
6. Нажмите "Create new project"

## Шаг 2: Настройка базы данных

1. Дождитесь завершения создания проекта
2. Перейдите в раздел **SQL Editor** (левое меню)
3. Создайте новый запрос
4. Скопируйте весь код из файла `database-setup.sql` и выполните его
5. Убедитесь, что все таблицы созданы успешно

## Шаг 3: Получение API ключей

1. Перейдите в **Settings** → **API** (левое меню)
2. Найдите секцию "Project API keys"
3. Скопируйте:
   - **Project URL** (например: `https://abcdefghijklmnop.supabase.co`)
   - **anon/public key** (длинная строка начинающаяся с `eyJ...`)

## Шаг 4: Настройка переменных окружения

1. В корне проекта создайте файл `.env.local`
2. Добавьте переменные:

```bash
NEXT_PUBLIC_SUPABASE_URL=https://your-project-id.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=your-anon-key-here
```

**Важно**: Замените значения на реальные из вашего Supabase проекта!

## Шаг 5: Настройка аутентификации

1. В Supabase перейдите в **Authentication** → **Settings**
2. В разделе "Site URL" добавьте:
   - Для разработки: `http://localhost:3000`
   - Для продакшена: ваш домен на Vercel
3. В разделе "Redirect URLs" добавьте:
   - `http://localhost:3000/**` (для разработки)
   - `https://your-domain.vercel.app/**` (для продакшена)

## Шаг 6: Проверка настройки

1. Запустите проект локально: `npm run dev`
2. Попробуйте зарегистрироваться через приложение
3. Проверьте, что:
   - Пользователь создается в таблице `auth.users`
   - Автоматически создается запись в таблице `employees`
   - Загружаются типы задач

## Шаг 7: Настройка для Vercel

1. В вашем Vercel проекте перейдите в **Settings** → **Environment Variables**
2. Добавьте те же переменные:
   - `NEXT_PUBLIC_SUPABASE_URL`
   - `NEXT_PUBLIC_SUPABASE_ANON_KEY`
3. Разверните проект заново

## Структура базы данных

После выполнения скрипта у вас будут созданы следующие таблицы:

### `employees`
- Профили сотрудников, связанные с auth.users
- Содержит рабочий график, позицию, статус онлайн

### `task_types`
- Типы задач для трекинга (Разработка, Тестирование, и т.д.)
- Предзаполненные данными

### `task_logs`
- Логи выполненных задач
- Время выполнения, количество единиц, заметки

### `work_sessions`
- Рабочие смены сотрудников
- Время начала/окончания, перерывы

### `employee_prizes`
- Призы и достижения сотрудников
- Система наград и геймификации

## Безопасность (RLS)

Все таблицы защищены Row Level Security (RLS):
- Пользователи могут видеть данные всех сотрудников (для статистики)
- Изменять могут только свои собственные записи
- Типы задач доступны только для чтения

## Полезные команды

### Проверка подключения
```sql
SELECT current_user, current_database();
```

### Просмотр созданных таблиц
```sql
SELECT table_name FROM information_schema.tables 
WHERE table_schema = 'public';
```

### Проверка данных
```sql
SELECT * FROM task_types;
SELECT * FROM employees;
```

## Устранение проблем

### Ошибка подключения
- Проверьте правильность URL и ключей
- Убедитесь, что переменные окружения установлены
- Перезапустите локальный сервер

### Ошибки RLS
- Убедитесь, что политики безопасности настроены корректно
- Проверьте, что пользователь аутентифицирован

### Проблемы с регистрацией
- Проверьте настройки аутентификации в Supabase
- Убедитесь, что триггер `handle_new_user` создан

## Готово!

После выполнения всех шагов ваш Task Logger будет работать с полноценной базой данных Supabase! 