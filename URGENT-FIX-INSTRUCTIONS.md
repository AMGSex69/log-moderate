# üö® –°–†–û–ß–ù–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï - –ü—Ä–æ–±–ª–µ–º—ã —Å –Ω–æ–≤—ã–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏

## –ü—Ä–æ–±–ª–µ–º—ã:
1. ‚ùå Employee —Å–æ–∑–¥–∞–µ—Ç—Å—è –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ (ID 144, 125, 126)
2. ‚ùå –û—à–∏–±–∫–∏ 406 (Not Acceptable) –ø—Ä–∏ –∑–∞–ø—Ä–æ—Å–∞—Ö –∫ –±–∞–∑–µ
3. ‚ùå –§—É–Ω–∫—Ü–∏—è –ª–∏–¥–µ—Ä–±–æ—Ä–¥–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç (404 –æ—à–∏–±–∫–∞)
4. ‚ùå –°–æ—Å—Ç–æ—è–Ω–∏–µ —Ä–∞–±–æ—Ç—ã —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è —Å–µ—Å—Å–∏–∏
5. ‚ùå –ü—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –≤—ã–±—Ä–∞—Å—ã–≤–∞–µ—Ç –Ω–∞ –≤—ã–±–æ—Ä –æ–∫—Ä—É–≥–∞

## –†–µ—à–µ–Ω–∏–µ:

### 1. üîß –ü—Ä–∏–º–µ–Ω–∏—Ç—å SQL —Å–∫—Ä–∏–ø—Ç –≤ Supabase

**‚ö†Ô∏è –í–ê–ñ–ù–û:** –ï—Å–ª–∏ –ø–æ–ª—É—á–∏–ª–∏ –æ—à–∏–±–∫—É CASCADE, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤—Ç–æ—Ä–æ–π —Å–∫—Ä–∏–ø—Ç!

#### –í–∞—Ä–∏–∞–Ω—Ç 1 (–ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–∞—á–∞–ª–∞):
–í—ã–ø–æ–ª–Ω–∏—Ç–µ SQL —Å–∫—Ä–∏–ø—Ç `fix-new-user-issues.sql` –≤ Supabase SQL Editor

#### –í–∞—Ä–∏–∞–Ω—Ç 2 (–µ—Å–ª–∏ –æ—à–∏–±–∫–∞ CASCADE):
–ï—Å–ª–∏ –ø–æ–ª—É—á–∏–ª–∏ –æ—à–∏–±–∫—É:
```
ERROR: cannot drop function handle_new_user() because other objects depend on it
HINT: Use DROP ... CASCADE to drop the dependent objects too.
```

–¢–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–∫—Ä–∏–ø—Ç `fix-new-user-issues-safe.sql` - –æ–Ω –∏—Å–ø–æ–ª—å–∑—É–µ—Ç CASCADE –¥–ª—è –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è.

**–®–∞–≥–∏:**
1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ Supabase Dashboard ‚Üí SQL Editor
2. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –≤–µ—Å—å –∫–æ–Ω—Ç–µ–Ω—Ç —Ñ–∞–π–ª–∞ `fix-new-user-issues-safe.sql`
3. –í—ã–ø–æ–ª–Ω–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –≤—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Å–æ–∑–¥–∞–Ω—ã —É—Å–ø–µ—à–Ω–æ

### 2. üì± –†–∞–∑–≤–µ—Ä–Ω—É—Ç–∞—è –≤–µ—Ä—Å–∏—è

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–æ: https://task-logger-1-j8qkhwlux-dolgihegor2323-gmailcoms-projects.vercel.app

### 3. üîç –ß—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ –∫–æ–¥–µ:

#### **RLS –ü–æ–ª–∏—Ç–∏–∫–∏:**
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –ø–æ–ª–∏—Ç–∏–∫–∏ –¥–ª—è `employees` - —Ä–∞–∑—Ä–µ—à–µ–Ω–æ —Å–æ–∑–¥–∞–Ω–∏–µ –∏ —á—Ç–µ–Ω–∏–µ
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –ø–æ–ª–∏—Ç–∏–∫–∏ –¥–ª—è `work_sessions` - –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤–ª–∞–¥–µ–Ω–∏—è
- ‚úÖ –ü–æ–ª–∏—Ç–∏–∫–∏ —Ä–∞–±–æ—Ç–∞—é—Ç —Å —Ç—Ä–∏–≥–≥–µ—Ä–∞–º–∏ –∏ —Ñ—É–Ω–∫—Ü–∏—è–º–∏

#### **–§—É–Ω–∫—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö:**
- ‚úÖ `get_leaderboard_with_current_user()` - —Å–æ–∑–¥–∞–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è –ª–∏–¥–µ—Ä–±–æ—Ä–¥–∞
- ‚úÖ `get_or_create_employee_id()` - –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ –ø–æ–ª—É—á–µ–Ω–∏–µ/—Å–æ–∑–¥–∞–Ω–∏–µ employee
- ‚úÖ `handle_new_user()` - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω —Ç—Ä–∏–≥–≥–µ—Ä —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏

#### **–ö–ª–∏–µ–Ω—Ç—Å–∫–∏–π –∫–æ–¥:**
- ‚úÖ `authService.getEmployeeId()` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –Ω–æ–≤—É—é –±–µ–∑–æ–ø–∞—Å–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –¥–ª—è –ª–∏–¥–µ—Ä–±–æ—Ä–¥–∞
- ‚úÖ –ó–∞—â–∏—Ç–∞ –æ—Ç –ø–∞–¥–µ–Ω–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ —Ñ—É–Ω–∫—Ü–∏–π

### 4. üß™ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è:

1. **–ù–æ–≤–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω —Å–æ–∑–¥–∞–≤–∞—Ç—å—Å—è —Å –æ–¥–Ω–∏–º employee ID
2. **–†–∞–±–æ—á–∏–µ —Å–µ—Å—Å–∏–∏:** –î–æ–ª–∂–Ω—ã —Ä–∞–±–æ—Ç–∞—Ç—å –±–µ–∑ –æ—à–∏–±–æ–∫ 406
3. **–õ–∏–¥–µ—Ä–±–æ—Ä–¥:** –ù–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –æ—à–∏–±–æ–∫ 404
4. **–ü–µ—Ä–µ—Ö–æ–¥—ã:** –ù–µ –¥–æ–ª–∂–Ω–æ –≤—ã–±—Ä–∞—Å—ã–≤–∞—Ç—å –Ω–∞ –≤—ã–±–æ—Ä –æ–∫—Ä—É–≥–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏

### 5. üîÑ –ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã –æ—Å—Ç–∞—é—Ç—Å—è:

```sql
-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–∑–¥–∞–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
SELECT proname FROM pg_proc WHERE proname LIKE '%employee%' OR proname LIKE '%leaderboard%';

-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å RLS –ø–æ–ª–∏—Ç–∏–∫–∏
SELECT schemaname, tablename, rowsecurity FROM pg_tables 
WHERE schemaname = 'public' AND tablename IN ('employees', 'work_sessions');

-- –û—á–∏—Å—Ç–∏—Ç—å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ employees (–û–°–¢–û–†–û–ñ–ù–û!)
DELETE FROM employees 
WHERE id NOT IN (
    SELECT MIN(id) FROM employees GROUP BY user_id
);
```

### 6. üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞:

–ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã –Ω–µ —Ä–µ—à–µ–Ω—ã:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ Supabase –≤ Dashboard ‚Üí Logs
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –æ—à–∏–±–æ–∫
3. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ SQL —Å–∫—Ä–∏–ø—Ç –≤—ã–ø–æ–ª–Ω–∏–ª—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫

---

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ö–æ–¥ –æ–±–Ω–æ–≤–ª–µ–Ω, ‚è≥ –û–∂–∏–¥–∞–µ—Ç—Å—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ SQL —Å–∫—Ä–∏–ø—Ç–∞ 